<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta property="og:site_name" content="ICJJ Blog"><meta property="og:type" content="article"><meta property="og:image" content="img/site/小米汽车/原型车壁纸/2880x1280/2880x1280-00.png"><meta property="twitter:image" content="img/site/小米汽车/原型车壁纸/2880x1280/2880x1280-00.png"><meta name=title content="AMBA5-APB-协议翻译"><meta property="og:title" content="AMBA5-APB-协议翻译"><meta property="twitter:title" content="AMBA5-APB-协议翻译"><meta name=description content="AMBA5 APB的协议翻译"><meta property="og:description" content="AMBA5 APB的协议翻译"><meta property="twitter:description" content="AMBA5 APB的协议翻译"><meta property="twitter:card" content="summary"><meta name=keyword content="程建军, chengjianjun, ChengJianjun, , 程建军的网络日志, 程建军的博客, ChengJianjun Blog, 博客, 个人网站, AMBA, FPGA, SPINALHDL, PCIE"><link rel="shortcut icon" href=/icer/img/site/favicon.ico><title>AMBA5-APB-协议翻译 | 程建军的博客 | ChengJianjun Blog</title>
<link rel=canonical href=/icer/post/amba-apb/><link rel=stylesheet href=/icer/css/bootstrap.min.css><link rel=stylesheet href=/icer/css/hugo-theme-cleanwhite.min.css><link rel=stylesheet href=/icer/css/zanshang.css><link rel=stylesheet href=/icer/css/font-awesome.all.min.css><script src=/icer/js/jquery.min.js></script><script src=/icer/js/bootstrap.min.js></script><script src=/icer/js/hux-blog.min.js></script><script src=/icer/js/lazysizes.min.js></script></head><script async src="https://www.googletagmanager.com/gtag/js?id=G-FWR2FVFK68"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-FWR2FVFK68")}</script><nav class="navbar navbar-default navbar-custom navbar-fixed-top"><div class=container-fluid><div class="navbar-header page-scroll"><button type=button class=navbar-toggle>
<span class=sr-only>Toggle navigation</span>
<span class=icon-bar></span>
<span class=icon-bar></span>
<span class=icon-bar></span>
</button>
<a class=navbar-brand href=/icer>ICJJ Blog</a></div><div id=huxblog_navbar><div class=navbar-collapse><ul class="nav navbar-nav navbar-right"><li><a href=/icer>Posts</a></li><li><a href=/icer/categories/bus/>bus</a></li><li><a href=/icer/categories/tech/>tech</a></li><li><a href=/icer/categories/tips/>tips</a></li><li><a href=/icer/archive/>ARCHIVE</a></li><li><a href=/icer/about/>ABOUT</a></li><li><a href=/icer/search><i class="fa fa-search"></i></a></li></ul></div></div></div></nav><script>var $body=document.body,$toggle=document.querySelector(".navbar-toggle"),$navbar=document.querySelector("#huxblog_navbar"),$collapse=document.querySelector(".navbar-collapse");$toggle.addEventListener("click",handleMagic);function handleMagic(){$navbar.className.indexOf("in")>0?($navbar.className=" ",setTimeout(function(){$navbar.className.indexOf("in")<0&&($collapse.style.height="0px")},400)):($collapse.style.height="auto",$navbar.className+=" in")}</script><style type=text/css>header.intro-header{background-image:url(/icer/img/site/%e5%b0%8f%e7%b1%b3%e6%b1%bd%e8%bd%a6/%e5%8e%9f%e5%9e%8b%e8%bd%a6%e5%a3%81%e7%ba%b8/2880x1280/2880x1280-00.png)}</style><header class=intro-header><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><div class=post-heading><div class=tags><a class=tag href=/tags/amba5 title=AMBA5>AMBA5
</a><a class=tag href=/tags/apb title=APB>APB</a></div><h1>AMBA5-APB-协议翻译</h1><h2 class=subheading></h2><span class=meta>Posted by
程建军
on
Sunday, March 17, 2024</span></div></div></div></div></header><article><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2
col-md-10 col-md-offset-1
post-container"><h1 id=a-idamba-apb-协议规范amba-apb-协议规范a><a id="AMBA APB 协议规范">AMBA APB 协议规范</a></h1><blockquote><p><a href=https://icjj.github.io/icer/document/IHI0024E_amba_apb_architecture_spec.pdf>IHI0024E_amba_apb_architecture_spec.pdf</a></p></blockquote><h2 id=a-idamba-apb-的协议翻译amba-apb-的协议翻译a><a id="AMBA APB 的协议翻译">AMBA APB 的协议翻译</a></h2><p><strong>发布信息<strong></p><table><thead><tr><th>时间</th><th>版本号</th><th>保密性</th><th>变化</th></tr></thead><tbody><tr><td>2023.09.05</td><td>A</td><td>无保密要求</td><td>第一次发布，v1.0</td></tr><tr><td>2004.08.17</td><td>B</td><td>无保密要求</td><td>第二次发布，v2.0</td></tr><tr><td>2010.04.13</td><td>C</td><td>无保密要求</td><td>第一次发布，v1.0</td></tr><tr><td>2021.05.09</td><td>D</td><td>无保密要求</td><td>为APB5版本加入了新功能</td></tr><tr><td>2023.02.28</td><td>E</td><td>无保密要求</td><td>在APB5版本加入了RME功能</td></tr></tbody></table><blockquote><p>Note:RME(Realm Management Extension)</p></blockquote><h3 id=a-id引言引言a><a id=引言>引言</a></h3><p>介绍了AMBA APB协议规范它包含以下部分：</p><ul><li><em><a href=#关于规范>关于规范</a></em></li><li><em><a href=#反馈>反馈</a></em></li><li><em><a href=#修订>修订</a></em></li></ul><h4 id=a-id关于规范关于规范a><a id=关于规范>关于规范</a></h4><p>此规格是针对高级微控制器总线架构（AMBA）高级外设总线（APB）协议规格的。</p><ul><li><em><a href=#目标受众>目标受众</a></em></li><li><em><a href=#使用本规范>使用本规范</a></em></li><li><em><a href=#约定>约定</a></em></li><li><em><a href=#外链阅读>外链阅读</a></em></li></ul><h5 id=a-id目标受众目标受众a><a id=目标受众>目标受众</a></h5><p>该规范是为希望熟悉AMBA APB协议的硬件和软件工程师编写的。</p><h5 id=a-id使用本规范使用本规范a><a id=使用本规范>使用本规范</a></h5><p>本规范组织如下章节：</p><p><em><a href="#第1章 介绍">第1章 介绍</a></em> ：介绍了AMBA APB协议的概述</br><em><a href="#第2章 信号介绍">第2章 信号介绍</a></em> ：介绍APB的信号</br><em><a href="#第3章 传输">第3章 传输</a></em> ：介绍APB的典型传输、错误响应和保护支持</br><em><a href="#第4章 操作状态">第4章 操作状态</a></em> ：介绍APB的操作状态和变换</br><em><a href="#第5章 接口校验保护">第5章 接口校验保护</a></em> ：介绍校验接口保护</br><em><a href="#附录a 信号有效性">附录A 信号有效性</a></em> ：介绍信号有效性的规则</br><em><a href="#附录b 信号列表">附录B 信号列表</a></em> ：汇总了APB的信号</br><em><a href=#版本>版本</a></em> ：介绍规范各个版本的变化。</br></p><h5 id=a-id约定约定a><a id=约定>约定</a></h5><p>本节描述了本规格使用的约定：</p><ul><li><a href=#排版>排版</a></li><li><a href=#时序图>时序图</a></li><li><a href=#信号>信号</a></li><li><a href=#数字>数字</a></li></ul><h6 id=a-id排版排版a><a id=排版>排版</a></h6><p>排版惯例是：</p><ul><li>italic(斜体)：突出重要笔记，介绍特殊术语，并指示内部交叉引用和引用。</li><li>bold(粗体)：表示信号名称，并用于描述性列表中的术语(如果适用)。</li><li>monospace(等宽)：该字体用于汇编程序语法描述、伪代码和源代码示例。</br>同时用于主要文本中的指令助记符，以及对出现在汇编程序语法描述、伪代码和源代码示例中的其他项目的引用。</li><li>SMALL CAPITALS(小写大写字母)：用于几个具有特定技术含义的术语。</li></ul><h6 id=a-id时序图时序图a><a id=时序图>时序图</a></h6><p><img src=https://icjj.github.io/icer/img/post/ahb/%e6%97%b6%e5%ba%8f%e5%9b%be%e7%ba%a6%e5%ae%9a.png alt></p><p>时序图有时会同时将单比特信号显示为高电平和低电平，它们看起来与时序图约定中的总线变化相似。
如果时序图以这种方式显示单比特信号，则其值不会影响随附的描述。
阴影总线和信号区域是未定义的，因此总线或信号可以在该时间内的阴影区域内假设任何值。实际电平并不重要，也不影响正常操作。</p><h6 id=a-id信号信号a><a id=信号>信号</a></h6><p>下面是关于信号方面的约定：</p><ul><li>信号电平：</br>断言信号的水平取决于信号是高有效还是低有效，断言意味着<ul><li>HIGH：表示高电平有效。</li><li>LOW：表示低电平有效。</li></ul></li><li>小写n：出现在信号名的开始或结束都表示低电平有效。</li><li>前缀H：表示AHB信号。</li><li>前缀P：表示APB信号。</li></ul><h6 id=a-id数字数字a><a id=数字>数字</a></h6><p>数字通常用十进制表示。二进制数字前加0b，而十六进制数字前加0x。</p><h5 id=a-id外链阅读外链阅读a><a id=外链阅读>外链阅读</a></h5><p><em><a href=https://developer.arm.com/docs>Arm Doc</a></em></p><h4 id=a-id反馈反馈a><a id=反馈>反馈</a></h4><ul><li>请通过填写 <em><a href=https://developer.arm.com/feedback/survey>https://developer.arm.com/feedback/survey</a></em>
上的表单，提交关于Arm产品文档的反馈意见。</li><li>有关Arm产品、架构和规格的技术反馈、问题或咨询，请在 <em><a href=https://support.developer.arm.com/my-cases/open-case/>https://support.developer.arm.com/my-cases/open-case/</a></em>
上提交支持请求。</li></ul><h4 id=a-id修订修订a><a id=修订>修订</a></h4><table><tr><th colspan=1>版本</th><th colspan=1>修改内容</th></tr><tr><td colspan=1>AMBA&emsp;&ensp;APB</td><td colspan=1>第一次发布</td></tr><tr><td colspan=1>AMBA2&emsp;APB&emsp;(issue A)</td><td colspan=1>这个版本是AMBA APB Rev 2</td></tr><tr><td colspan=1>AMBA3&emsp;APB&emsp;(issue B)</td><td colspan=1>添加了事务等待信号<a href=#pready>PREADY</a>：表明事务是否结束;<br>添加了错误响应信号<a href=#pslverr>PSLVERR</a>：表明事务是否有误;</td></tr><tr><td colspan=1>AMBA4&emsp;APB&emsp;(issue C)</td><td colspan=1>添加了等待信号<a href=#pprot>PPROT</a>：事务的访问类型;<br>添加了等待信号<a href=#pstrb>PSTRB</a>：类似于闸门的功能，以支持稀疏事务;<br></td></tr><tr><td colspan=1>AMBA5&emsp;APB&emsp;(issue D)</td><td colspan=1>添加了唤醒信号<a href=#pprot>PPROT</a><br>添加了用户自定义信号<br><a href=#pauser>PRUSER</a><br><a href=#pwuser>PWUSER</a><br><a href=#pruser>PRUSER</a><br><a href=#pbuser>PBUSER</a><br></td></tr><tr><td colspan=1>AMBA5&emsp;APB&emsp;(issue E)</td><td colspan=1>支持RME功能,添加了物理地址分区指示信号<br><a href=#pnse>PNSE</a><br></td></tr></table><h3 id=a-id第1章-介绍第1章-介绍a><a id="第1章 介绍">第1章 介绍</a></h3><p>本章提供了APB协议的概述。它包含以下几个部分：</p><ul><li><em><a href="#1.1 关于APB">1.1 关于APB</a></em></li></ul><h4 id=a-id11-关于apb11-关于apba><a id="1.1 关于APB">1.1 关于APB</a></h4><p>APB协议是一种低成本接口，优化了最小功耗和减少接口复杂性。
APB接口没有流水线，是一种简单的同步协议。
每次传输至少需要两个周期才能完成。</p><p>APB接口旨在访问外围设备的可编程控制寄存器。
APB外设通常通过APB桥连接到主存储系统。
例如，可以使用AXI到APB的桥将多个APB外设连接到AXI存储系统。</p><p>APB传输由APB桥启动。APB桥也可以称为请求者（主机）。
外设接口对请求作出响应。APB外设也可以称为完成者（从机）。本规范将使用请求者（主机）和完成者（从机）。</p><h3 id=a-id第2章-信号介绍第2章-信号介绍a><a id="第2章 信号介绍">第2章 信号介绍</a></h3><p>本章描述了AMBA APB信号。它包含以下部分：</p><ul><li><em><a href="#2.1 信号介绍">2.1 信号介绍</a></em></li></ul><h4 id=21-amba-apb-信号>2.1 AMBA APB 信号</h4><p>本节描述了APB接口信号。</p><p>某些APB接口上的信号具有固定宽度，而某些信号可以具有多种宽度。
当宽度不是固定时，它通过属性进行描述。
如果属性值为零，这意味着该信号在接口上不存在。</p><p><em><a href="#表 2-1">表 2-1</a></em> 提供了APB协议接口信号的描述。</p><p><a id="表 2-1">表 2-1</a> APB 信号描述</p><table><thead><tr><th><strong>信号名</strong></th><th><strong>信号源</strong></th><th><strong>位宽</strong></th><th><strong>描述</strong></th></tr></thead><tbody><tr><td><strong>PCLK</strong></td><td>时钟源</td><td>1</td><td>时钟。<br><strong>PCLK</strong>是时钟信号。所有APB信号都在<strong>PCLK</strong>的上升沿进行采样。</td></tr><tr><td><strong>PRESETn</strong></td><td>复位源</td><td>1</td><td>复位。<br><strong>PRESETn</strong>是复位信号，且为低有效信号。<br><strong>PRESETn</strong>通常直接连接到系统总线复位信号。</td></tr><tr><td><strong>PADDR</strong>PADDR</td><td>主机</td><td>ADDR_WIDTH</td><td>地址。<strong>PADDR</strong>是APB地址总线，<strong>PADDR</strong>宽度可以达到32位。</td></tr><tr><td><strong>PPROT</strong></td><td>主机</td><td>3</td><td>保护类型。<br><strong>PPROT</strong>表示传输的正常、特权或安全保护级别，以及该传输是数据访问还是指令访问。详见 <em><a href="#3.5 保护单元支持">3.5 保护单元支持</a></em></td></tr><tr><td><strong>PNSE</strong></td><td>主机</td><td>1</td><td>扩展保护类型。详见 <em><a href="#3.6 realm扩展管理，RME">3.6 Realm扩展管理，RME</a></em></td></tr><tr><td><strong>PSELx</strong></td><td>主机</td><td>1</td><td>选择。<br>主机为每个从机生成一个<strong>PSELx</strong>信号，<strong>PSELx</strong>表示从机被选择并且需要进行数据传输。</td></tr><tr><td><strong>PENABLE</strong></td><td>主机</td><td>1</td><td>使能。<br><strong>PENABLE</strong>表示APB传输的第二个及后续周期。</td></tr><tr><td>strong>PWRITE</strong></td><td>主机</td><td>1</td><td>方向。<br>高电平<strong>PWRITE</strong>表示APB是写入访问，低电平<strong>PWRITE</strong>表示APB读取访问。</td></tr><tr><td><strong>PWDATA</strong></td><td>主机</td><td>DATA_WIDTH</td><td>写数据。<br><strong>PWRITE</strong>写数据总线在写周期内由APB桥主机驱动，当<strong>PWRITE</strong>为高电平时<strong>PWDATA</strong>可以是8位、16位或32位宽。</td></tr><tr><td><strong>PSTRB</strong></td><td>主机</td><td>DATA_WIDTH/8</td><td>脉冲写信号。<br>PSTRB 指示在写传输期间要更新哪些字节通道。每 8 位写数据总线有一个写使能信号。<strong>PSTRB[n]</strong>对应于<strong>PWDATA[(8n + 7):(8n)]</strong>。在读传输期间，<strong>PSTRB</strong>不能处于活动状态。详见 <em><a href="#3.2 脉冲写">3.2 脉冲写</a></em></td></tr><tr><td><strong>PREADY</strong></td><td>从机</td><td>1</td><td>准备。<br><strong>PREADY</strong>用于从机扩展APB传输。</td></tr><tr><td><strong>PRDATA</strong></td><td>从机</td><td>DATA_WIDTH</td><td>读取数据。<br>在<strong>PWRITE</strong>为低时，<strong>PRDATA</strong>读取数据总线由所选的从机在读取周期内驱动，<strong>PRDATA</strong>可以是8位、16位或32位宽。</td></tr><tr><td><strong>PSLVERR</strong></td><td>从机</td><td>1</td><td>传输错误。<strong>PSLVERR</strong>是一个可选信号，可以由主机设置为高电平，以指示APB传输出现错误。详见 <em><a href="#3.4 错误响应">3.4 错误响应</a></em></td></tr><tr><td><strong>PWAKEUP</strong></td><td>主机</td><td>1</td><td>唤醒。<br><strong>PWAKEUP</strong>指的是与APB接口相关的任何唤醒动作。详见 <em><a href="#3.7 唤醒信号">3.7 唤醒信号</a></em></td></tr><tr><td><strong>PAUSER</strong></td><td>主机</td><td>USER_REQ_WIDTH</td><td>user请求属性。<br>建议<strong>PAUSER</strong>的最大宽度为128位。 详见 <em><a href="#3.8 user信号">3.8 user信号</a></em></td></tr><tr><td><strong>PWUSER</strong></td><td>主机</td><td>USER_DATA_WIDTH</td><td>user写数据属性。<br>建议<strong>PWUSER</strong>的最大宽度为DATA_WIDTH/2。详见 <em><a href="#3.8 user信号">3.8 user信号</a></em></td></tr><tr><td><strong>PRUSER</strong></td><td>从机</td><td>USER_DATA_WIDTH</td><td>user读数据属性。<br>建议<strong>PRUSER</strong>的最大宽度为DATA_WIDTH/2。详见 <em><a href="#3.8 user信号">3.8 user信号</a></em></td></tr><tr><td><strong>PBUSER</strong></td><td>从机</td><td>USER_RESP_WIDTH</td><td>user响应属性。<strong>PBUSER</strong>建议最大宽度为16位。详见 <em><a href="#3.8 user信号">3.8 user信号</a></em></td></tr></tbody></table><h5 id=a-id211-地址总线211-地址总线a><a id="2.1.1 地址总线">2.1.1 地址总线</a></h5><p>APB接口有一个单一的地址总线<strong>PADDR</strong>用于读写传输。<strong>PADDR</strong>表示字节地址。</p><p><strong>PADDR</strong>可以与数据宽度不对齐，但结果是不可预测的。
例如，一个从机可能使用未对齐的地址、对齐的地址，发出错误响应。</p><p>[ For example, a 从机 might use the unaligned address, aligned address, or signal an error response.]</p><h5 id=212-数据总线>2.1.2 数据总线</h5><p>APB协议具有两个独立的数据总线，<strong>PRDATA</strong>用于读取数据，<strong>PWDATA</strong>用于写入数据。
这些总线可以是8位、16位或32位宽。
读取数据总线和写入数据总线必须具有相同的宽度。</p><p>数据传输不能同时进行，因为读取数据和写入数据总线没有各自独立的握手信号。</p><h3 id=a-id第3章-传输第3章-传输a><a id="第3章 传输">第3章 传输</a></h3><p>本章描述了典型的AMBA APB传输、错误响应和保护单元支持，包含以下各节：</p><ul><li><em><a href="#3.1 写传输">3.1 写传输</a></em></li><li><em><a href="#3.2 脉冲写">3.2 脉冲写</a></em></li><li><em><a href="#3.3 读传输">3.3 读传输</a></em></li><li><em><a href="#3.4 error响应">3.4 ERROR响应</a></em></li><li><em><a href="#3.5 保护单元支持">3.5 保护单元支持</a></em></li><li><em><a href="#3.6 realm 管理扩展，rme">3.6 Realm 管理扩展，RME</a></em></li><li><em><a href="#3.7 唤醒信号">3.7 唤醒信号</a></em></li><li><em><a href="#3.8 user信号">3.8 user信号</a></em></li></ul><h4 id=a-id31-写传输31-写传输a><a id="3.1 写传输">3.1 写传输</a></h4><p>本节描述以下几种写入传输类型：</p><ul><li><em><a href="#3.1.1 无等待写">3.1.1 无等待写</a></em></li><li><em><a href="#3.1.2 有等待写">3.1.2 有等待写</a></em></li></ul><p>本节中显示的所有信号都在PCLK的上升沿采样。</p><h5 id=a-id311-无等待写311-无等待写a><a id="3.1.1 无等待写">3.1.1 无等待写</a></h5><p><em><a href="#图 3-1">图 3-1</a></em> 显示了一个没有等待状态的基本写入传输。</p><p><a id="图 3-1">图 3-1
<img src=https://icjj.github.io/icer/img/post/apb/Figure_3-1_Write_transfer_with_no_wait_states.png alt></a></p><p>在 <em><a href="#图 3-1">图 3-1</a></em> 中：</p><ul><li>T0-T1：</br>无动作。</li><li>T1-T2：</br>主机请求对地址Addr1发起strong>PWRITE</strong>为高的Setup阶段写传输。</br>从机无动作。</li><li>T2-T3：</br>主机请求对地址Addr1发起<strong>PENABLE</strong>为高的Access阶段写传输。</br>从机拉高<strong>PREADY</strong>完成地址Addr1的传输。</li><li>T3-T4：</br>无动作。</li></ul><p>写入传输的Setup阶段发生在 <em><a href="#图 3-1">图 3-1</a></em> 中的T1处。
选择信号<strong>PSELx</strong>被置为有效，
这意味着<strong>PADDR</strong>、strong>PWRITE</strong>和<strong>PWDATA</strong>必须是有效的。</p><p>写入传输的Access阶段在 <em><a href="#图 2-1">图 2-1</a></em> 中的T2处显示，在此期间<strong>PENABLE</strong>被置为有效。
<strong>PREADY</strong>在<strong>PCLK</strong>上升沿由从机置为有效，以指示写入数据将在T3处被接受。
<strong>PADDR</strong>、<strong>PWDATA</strong>和其他任何控制信号必须稳定，直到传输完成。</p><p>在传输结束时，<strong>PENABLE</strong>被取消。除非存在另一个传输到同一外设，否则<strong>PSELx</strong>也被取消。</p><h5 id=a-id312-有等待写312-有等待写a><a id="3.1.2 有等待写">3.1.2 有等待写</a></h5><p><em><a href="#图 3-2">图 3-2</a></em> 显示了从机如何使用<strong>PREADY</strong>来扩展写传输。</p><p><a id="图 3-2">图 3-2
<img src=https://icjj.github.io/icer/img/post/apb/Figure_3-2_Write_transfer_with_wait_states.png alt></a></p><p>在 <em><a href="#图 3-2">图 3-2</a></em> 中</p><ul><li>T0-T1：</br>无动作。</li><li>T1-T2：</br>主机请求对地址Addr1发起strong>PWRITE</strong>为高的Setup阶段写传输。</br>从机无动作。</li><li>T2-T3：</br>主机请求对地址Addr1发起<strong>PENABLE</strong>为高的Access阶段写传输。</br>从机拉低<strong>PREADY</strong>请求主机对传输插入一个等待周期。</li><li>T3-T4：</br>主机保持不变。</br>从机保持不变。</li><li>T4-T5：</br>主机保持不变。</br>从机拉高<strong>PREADY</strong>完成地址Addr1的传输。</li><li>T5-T6：</br>无动作。</li></ul><p>在Access阶段，当<strong>PENABLE</strong>为高时，从机通过将<strong>PREADY</strong>拉低来扩展传输。</p><p>在<strong>PREADY</strong>为低时，以下信号保持不变：</p><ul><li>地址信号，<strong>PADDR</strong></li><li>方向信号，<strong>PWRITE</strong></li><li>选择信号，<strong>PSELx</strong></li><li>使能信号，<strong>PENABLE</strong></li><li>写数据信号，<strong>PWDATA</strong></li><li>写脉冲信号，<strong>PSTRB</strong></li><li>保护类型信号，<strong>PPROT</strong></li><li>用户请求属性，<strong>PAUSER</strong></li><li>用户写数据属性，<strong>PWUSER</strong></li></ul><p>当<strong>PENABLE</strong>为低时，<strong>PREADY</strong>可以取任何值。
这确保了具有固定两个周期访问的外设可以将<strong>PREADY</strong>拉高。</p><h4 id=a-id32-脉冲写32-脉冲写a><a id="3.2 脉冲写">3.2 脉冲写</a></h4><p><strong>PSTRB</strong>使得写数据总线上的稀疏数据传输成为可能。
每个<strong>PSTRB</strong>对应于写数据总线的1个字节。
当<strong>PSTRB</strong>某个bit变为高电平时，表示写数据总线相应的字节通道包含有效信息。</p><p>每8位写数据总线都与一个<strong>PSTRB</strong> bit对应，
因此<strong>PSTRB[n]</strong>对应于<strong>PWDATA[(8n + 7):(8n)]</strong>。</p><p><em><a href="#图 3-3">图 3-3</a></em> 展示了在 32 位数据总线上的这种关系。</p><p><a id="图 3-3">图 3-3
<img src=https://icjj.github.io/icer/img/post/apb/Figure_3-3_Byte_lane_mapping.png alt></a></p><p>对于读取传输，请求者必须将所有PSTRB位拉低。</p><h5 id=a-id321-pstrb的兼容性321-pstrb的兼容性a><a id="3.2.1 PSTRB的兼容性">3.2.1 PSTRB的兼容性</a></h5><p><strong>PSTRB</strong>是一个可选信号。
APB外设可能支持有限的访问类型，这些类型必须记录给程序员。
这意味着如果该文档声明不支持稀疏写入，则所有<strong>PSTRB</strong>存在的组合可能是兼容的。
当连接主机和从机时，<strong>PSTRB</strong>的兼容性描述在 <em><a href="#表 3-1">表 3-1</a></em> 。</p><p><a id="表 3-1">表 3-1</a> <strong>PSTRB</strong>的存在与兼容性</p><table><thead><tr><th><strong>PSTRB</strong></th><th>从机不存在该信号</th><th>从机存在该信号</th></tr></thead><tbody><tr><td>主机不存在该信号</td><td>兼容。</br>不支持稀疏写。</td><td>兼容.</br>所有写数据字节通道在写入时均有效。</br><strong>PSTRB</strong>应该与<strong>PWDATA</strong>直接连接。</td></tr><tr><td>主机存在该信号</td><td>兼容。</br>不支持稀疏写。</td><td>兼容。</br>不支持稀疏写.</td></tr></tbody></table><h4 id=a-id33-读传输33-读传输a><a id="3.3 读传输">3.3 读传输</a></h4><p>包含有两种读方式：</p><ul><li><em><a href="#3.3.1 无等待读传输">3.3.1 无等待读传输</a></em></li><li><em><a href="#3.3.2 有等待读传输">3.3.2 有等待读传输</a></em></li></ul><p>本节中显示的所有信号都在PCLK的上升沿采样。</p><h5 id=a-id331-无等待读传输331-无等待读传输a><a id="3.3.1 无等待读传输">3.3.1 无等待读传输</a></h5><p><em><a href="#图 3-4">图 3-4</a></em> 显示了无等待读取传输。</p><p><a id="图 3-4">图 3-4
<img src=https://icjj.github.io/icer/img/post/apb/Figure_3-4_Read_transfer_with_no_wait_states.png alt></a></p><p>在 <em><a href="#图 3-4">图 3-4</a></em> 中：</p><ul><li>T0-T1：</br>无动作。</li><li>T1-T2：</br>主机请求对地址Addr1发起strong>PWRITE</strong>为低的Setup阶段读传输。</br>从机无动作。</li><li>T2-T3：</br>主机请求对地址Addr1发起<strong>PENABLE</strong>为高的Access阶段读传输。</br>从机拉高<strong>PREADY</strong>完成地址Addr1的传输。</li><li>T3-T4：</br>无动作。</li></ul><p>地址信号<strong>PADDR</strong>、写信号<strong>PWRITE</strong>、选择信号<strong>PSELx</strong>和
使能信号<strong>PENABLE</strong>的时序与 <em><a href="#3.1.1 无等待写传输">3.1.1 无等待写传输</a></em> 描述的相似。
主机必须在读传输结束之前提供数据。</p><h5 id=a-id332-有等待读332-有等待读a><a id="3.3.2 有等待读">3.3.2 有等待读</a></h5><p><em><a href="#图 3-5">图 3-5</a></em> 展示了<strong>PREADY</strong>信号如何扩展读传输。</p><p><a id="图 3-5">图 3-5
<img src=https://icjj.github.io/icer/img/post/apb/Figure_3-5_Read_transfer_with_wait_states.png alt></a></p><p>在 <em><a href="#图 3-5">图 3-5</a></em> 中</p><ul><li>T0-T1：</br>无动作。</li><li>T1-T2：</br>主机请求对地址Addr1发起strong>PWRITE</strong>为低的Setup阶段读传输。</br>从机无动作。</li><li>T2-T3：</br>主机请求对地址Addr1发起<strong>PENABLE</strong>为高的Access阶段读传输。</br>从机拉低<strong>PREADY</strong>请求主机对传输插入一个等待周期。</li><li>T3-T4：</br>主机保持不变。</br>从机保持不变。</li><li>T4-T5：</br>保持不变。</br>从机拉高<strong>PREADY</strong>完成地址Addr1的传输。</li><li>T5-T6：</br>无动作。</li></ul><p>如果在Access阶段期间将<strong>PREADY</strong>拉低，则传输将延长。
以下信号在<strong>PREADY</strong>保持拉低时保持不变：</p><ul><li>地址信号，<strong>PADDR</strong></li><li>方向信号，<strong>PWRITE</strong></li><li>选择信号，<strong>PSELx</strong></li><li>使能信号，<strong>PENABLE</strong></li><li>保护信号，<strong>PPROT</strong></li><li>用户信号，<strong>PAUSER</strong></li></ul><p><em><a href="#图 3-5">图 3-5</a></em> 显示使用<strong>PREADY</strong>添加了两个周期等待。
然而，可以添加任意数量的额外周期实现等待操作。</p><h4 id=a-id34-error响应34-error响应a><a id="3.4 error响应">3.4 ERROR响应</a></h4><p><strong>PSLVERR</strong>可用于指示APB传输中的错误状态。错误状态可以在读和写传输中发生。</p><p><strong>PSLVERR</strong>仅在APB传输的最后一个周期内被视为有效，
此时<strong>PSELx</strong>、<strong>PENABLE</strong>和<strong>PREADY</strong>均为高电平。</p><p>建议，但不要求，当<strong>PSELx</strong>、<strong>PENABLE</strong>或<strong>PREADY</strong>为低电平时，
将<strong>PSLVERR</strong>驱动为低电平。</p><p>收到错误的传输可能已经或未改变外设的状态，
相对于于外设来说，两种状态都是可以接受的。
当写传输收到错误时，并不意味着外设内的寄存器没有被更新。</p><p>收到错误的读传输可能返回无效数据，
对于读错误，外设没有必要将数据总线驱动为全0。</p><p>收到读传输错误响应的主机仍然可以使用该数据。
从机不能依赖错误响应来阻止读取<strong>PRDATA</strong>上的值。</p><p>从机不强制支持<strong>PSLVERR</strong>。
如果主机不包含<strong>PSLVERR</strong>，
则主机的相应输入应该被连接为低电平。</p><h5 id=a-id341-写传输341-写传输a><a id="3.4.1 写传输">3.4.1 写传输<a></h5><p><em><a href="#图 3-6">图 3-6</a></em> 显示了一个失败的写入传输示例，该传输以错误结束。</p><p>在 <em><a href="#图 3-6">图 3-6</a></em> 中</p><ul><li>T0-T1：</br>无动作。</li><li>T1-T2：</br>主机请求对地址Addr1发起strong>PWRITE</strong>为高的Setup阶段写传输。</br>从机无动作。</li><li>T2-T3：</br>主机请求对地址Addr1发起<strong>PENABLE</strong>为高的Access阶段写传输。</br>从机拉低<strong>PREADY</strong>请求主机对传输插入一个等待周期。</li><li>T4-T5：</br>主机保持不变。</br>从机拉高<strong>PREADY</strong>和<strong>PSLVERR</strong>完成地址Addr1的失败传输。</li><li>T5-T6：</br>无动作。</li></ul><p><a id="图 3-6">图 3-6
<img src=https://icjj.github.io/icer/img/post/apb/Figure_3-6_Example_failing_write_transfer.png alt></a></p><h5 id=a-id342-读传输342-读传输a><a id="3.4.2 读传输">3.4.2 读传输</a></h5><p>读取传输也可以用ERROR响应完成，表示没有有效的读取数据可用。
<em><a href="#图 3-7">图 3-7</a></em> 显示了一个以ERROR响应完成的读取传输。</p><p><a id="图 3-7">图 3-7
<img src=https://icjj.github.io/icer/img/post/apb/Figure_3-7_Example_failing_read_transfer.png alt></a></p><p>在 <em><a href="#图 3-7">图 3-7</a></em> 中</p><ul><li>T0-T1：</br>无动作。</li><li>T1-T2：</br>主机请求对地址Addr1发起strong>PWRITE</strong>为低的Setup阶段读传输。</br>从机无动作。</li><li>T2-T3：</br>主机请求对地址Addr1发起<strong>PENABLE</strong>为高的Access阶段读传输。</br>从机拉低<strong>PREADY</strong>请求主机对传输插入一个等待周期。</li><li>T3-T4：</br>主机保持不变。</br>从机保持不变。</li><li>T4-T5：</br>保持不变。</br>从机拉高<strong>PREADY</strong>和<strong>PSLVERR</strong>完成地址Addr1的ERROR传输。</li><li>T5-T6：</br>无动作。</li></ul><h5 id=a-id343-pslverr的映射343-pslverr的映射a-343-pslverr的映射关系><a id="3.4.3 PSLVERR的映射">3.4.3 PSLVERR的映射</a> 3.4.3 PSLVERR的映射关系</h5><p>当进行桥接时：</p><ul><li>从AXI到APB： 在<strong>PSLVERR</strong>上的APB错误被映射回AXI读取的RRESP和写入的BRESP。</li><li>从AHB到APB： 在<strong>PSLVERR</strong>上的APB错误被映射回AHB读取和写入的HRESP。</li></ul><h4 id=a-id35-保护但愿支持35-保护但愿支持a><a id="3.5 保护但愿支持">3.5 保护但愿支持</a></h4><p>为了支持复杂的系统设计，通常需要系统中的互连和其他设备提供对非法交易的保护。
对于APB接口，这种保护通过<strong>PPROT[2:0]</strong>信号提供。
<em><a href="#表 3-2">表 3-2</a></em> 显示了三种访问保护级别及其保护级别编码。</p><p><a id="表 3-2">表 3-2</a> 访问保护</p><table><thead><tr><th><strong>PPROT</strong></th><th>保护类型</th><th>描述</th><th>信号值和对应保护类型</th></tr></thead><tbody><tr><td><strong>PPROT[0]</strong></td><td>Normal或Privileged</td><td><strong>PPROT[0]</strong>被主机用来指示处理模式。特权处理模式通常在系统中具有更高的访问级别。</td><td>LOW：normal<br>HIGH：privileged</td></tr><tr><td><strong>PPROT[1]</strong></td><td>Secure或Non-secure</td><td><strong>PPROT[1]</strong>用于需要在处理模式之间具有更大区分度的系统。</td><td>LOW：secure<br>HIGH：None-secure</td></tr><tr><td><strong>PPROT[2]</strong></td><td>Data或Instruction</td><td><strong>PPROT[0]</strong>用于指示该传输是否为数据或指令访问，传输指示作为提示提供，在所有情况下并不一定准确</td><td>LOW：data<br>HIGH：Inst</td></tr></tbody></table><blockquote><p>Note：PPROT的主要用途是作为安全或非安全交易的标识符。
使用不同的PPROT[0]和PPROT[2]标识符的解释是可以接受的。</p></blockquote><h3 id=a-id351-pprot的存在和兼容性351-pprot的存在和兼容性a><a id="3.5.1 PPROT的存在和兼容性">3.5.1 PPROT的存在和兼容性</a></h3><p>PPROT是主机和从机接口上的一个可选信号。
<em><a href="#表 3-3">表 3-3</a></em> 描述了连接主机到从机时的<strong>PPROT</strong>兼容性表现。</p><p><a id="表 3-3">表 3-3</a> <strong>PPROT[0]</strong>的存在和兼容性</p><table><thead><tr><th><strong>PPROT</strong></th><th>从机不存在该信号</th><th>从机存在该信号</th></tr></thead><tbody><tr><td>主机不存在该信号</td><td>兼容</td><td>不兼容，如果在功能上保证了正确就是兼容的。详见 <em><a href="#表 3-2">表 3-2</a></em></td></tr><tr><td>主机存在该信号</td><td>兼容，从机无法访问该信号，因此该信号可以被忽略。</td><td>兼容</td></tr></tbody></table><h4 id=a-id36-realm-管理扩展rme36-realm-管理扩展rmea><a id="3.6 realm 管理扩展，rme">3.6 Realm 管理扩展，RME</a></h4><p>本节描述了APB协议对Arm ® Realm Management Extension (RME)系统架构的支持。
RME是ARM TrustZoon架构的一部分。</p><h5 id=a-id361-root和realm-物理地址空间361-root和realm-物理地址空间a><a id="3.6.1 Root和Realm 物理地址空间">3.6.1 Root和Realm 物理地址空间</a></h5><p>RME将Root和Realm物理地址空间添加到Arm架构中。
这些可以在APB事务的权限检查中使用。
<em><a href="#表 3-4">表 3-4</a></em> 列出了为支持RME而在APB5接口上添加的额外信号。</p><p><a id="表 3-4">表 3-4</a> PNSE信号描述</p><table><thead><tr><th>信号</th><th>位宽</th><th>信号源</th><th>描述</th></tr></thead><tbody><tr><td>PNSE</td><td>1</td><td>主机</td><td>扩展保护类型。</br>当<strong>PSELx</strong>被置为有效时<strong>PNSE</strong>必须有效</td></tr></tbody></table><p><em><a href="#表 3-5">表 3-5</a></em> 列出了<strong>PNSE</strong>和<strong>PPROT</strong>的允许组合，
这些组合决定了事务的物理地址空间。</p><p><a id="表 3-5">表 3-5</a> <strong>PNSE</strong>和<strong>PPROT[1]</strong>决定了传输的物理地址空间</p><table><thead><tr><th><strong>PNSE</strong></th><th><strong>PPROT[1]</strong></th><th>物理地址空间</th></tr></thead><tbody><tr><td>1</td><td>2</td><td>Secure</td></tr><tr><td>1</td><td>1</td><td>Non-secure</td></tr><tr><td>1</td><td>2</td><td>Root</td></tr><tr><td>1</td><td>1</td><td>Realm</td></tr></tbody></table><h5 id=a-id362-配置362-配置a><a id="3.6.2 配置">3.6.2 配置</a></h5><p>RME_Support 属性用于指示 APB 接口是否支持 RME：</p><ul><li>True：RME是支持的，<strong>PNSE</strong>信号在接口上存在，且能在APB5接口上使用。</li><li>False：RME不支持。<strong>PNSE</strong>信号在接口上不存在，如果在接口上未声明RME_Support属性，则视为False。</li></ul><p>如果<strong>PNSE</strong>存在于接口上，<strong>PPROT</strong>也必须存在。</p><p><strong>PNSE</strong>信号使用<strong>PCTRLCHK</strong>信号进行奇偶校验保护。</p><p><em><a href="#表 3-6">表 3-6</a></em> 列出了依据RME_Support属性的值，主机和从机接口之间的兼容性，</p><p><a id="表 3-6">表 3-6</a> RME_Support 存在和兼容性</p><table><thead><tr><th>RME_Support</th><th>从机不存在该信号</th><th>从机存在该信号</th></tr></thead><tbody><tr><td>主机不存在该信号</td><td>兼容</td><td>兼容。</br><strong>PNSE</strong>绑定为LOW</td></tr><tr><td>主机存在该信号</td><td>不兼容</td><td>兼容</td></tr></tbody></table><h4 id=a-id37-唤醒信号37-唤醒信号a><a id="3.7 唤醒信号">3.7 唤醒信号</a></h4><p>本节描述了在APB接口中使用的唤醒信号。</p><h5 id=a-id371-介绍371-介绍a><a id="3.7.1 介绍">3.7.1 介绍</a></h5><p>唤醒信号<strong>PWAKEUP</strong>用于指示与任何APB接口关联的任何唤醒行为。</p><p><strong>PWAKEUP</strong>提供一个无毛刺的信号，可以路由到时钟控制器或类似组件，
以使连接组件的电源和时钟启用Wakeup_Signal属性用于指示组件是否支持唤醒信号：</p><ul><li>True：存在唤醒信号</li><li>False 不存在唤醒信号。如果未声明Wakeup_Signal属性，则视为False。</li></ul><p>唤醒信号只能添加到APB5协议接口。</p><h5 id=a-id372-唤醒信号372-唤醒信号a><a id="3.7.2 唤醒信号">3.7.2 唤醒信号</a></h5><p><em><a href="#表 3-7">表 3-7</a></em> 描述了<strong>PWAKEUP</strong>信号。</p><p><a id="表 3-7">表 3-7</a> <strong>PWAKEUP</strong>信号描述</p><table><thead><tr><th>信号</th><th>位宽</th><th>信号源</th><th>描述</th></tr></thead><tbody><tr><td><strong>PWAKEUP</strong></td><td>1</td><td>主机</td><td><strong>PWAKEUP</strong>指与主机接口相关的任何唤醒行为。</td></tr></tbody></table><p><strong>PWAKEUP</strong>的规则和建议如下：</p><ul><li><strong>PWAKEUP</strong>与<strong>PCLK</strong>同步，必须适合在与其不同的时钟域中异步采样。
是<strong>PWAKEUP</strong>无毛刺所需要的。例如，可以通过直接从寄存器生成或通过无毛刺的OR树来实现。</li><li><strong>PWAKEUP</strong>可以在<strong>PSELx</strong>断言之前、期间或之后被断言。</li><li>在<strong>PREADY</strong>断言之前，允许主机等待<strong>PWAKEUP</strong>被断言。
如果<strong>PWAKEUP</strong>存在但从未被断言，接口可能会出现死锁。</li><li>如果<strong>PWAKEUP</strong>和<strong>PSELx</strong>在同一个周期内均为HIGH，
<strong>PWAKEUP</strong>必须保持被断言状态，直至<strong>PREADY</strong>被断言。</li><li>建议在断言<strong>PSELx</strong>之前至少提前一个周期断言<strong>PWAKEUP</strong>，以防止新传输被延迟。</li><li>建议在不再需要进一步传输时解除<strong>PWAKEUP</strong>的断言。</li><li>允许但不建议在没有发生传输的情况下先断言<strong>PWAKEUP</strong>再解除其断言。</li><li>建议连接的主机和从机的时钟一起进行时钟门控。
如果从机接口的时钟与主机时钟独立门控，并且使用<strong>PWAKEUP</strong>启用从机时钟，
则存在从机错过传输的Setup阶段的可能性。</li></ul><h2 id=38-user-信号>3.8 user 信号</h2><h3 id=381-介绍>3.8.1 介绍</h3><p>使用apb协议时可能会遇到添加apb协议中未指定信号的情况。user信号提供了一种将此类信号添加到apb事务中，而无需定义接口信号。</p><p>【建议】一般情况下不要使用user信号，由于apb协议对这些信号的功能未定义，两个组件1以不兼容的方式使用相同的用户信号，可能会引起一些操作性的问题。</p><p>user信号只能在APB5中使用。</p><h3 id=382-信号>3.8.2 信号</h3><p>所有的信号都是可选的，如果相关的信号位宽为0，则该信号不在接口中出现。</p><table><thead><tr><th>信号</th><th>位宽</th><th>信号源</th><th>描述</th></tr></thead><tbody><tr><td>PAUSER</td><td>USER_REQ_WIDTH</td><td>主机</td><td>用户定义的请求。<br>- 当PSELx拉高时，PAUSER必须有效。<br>- 在一笔事务的setup和access阶段内PAUSER值必须保持不变。<br>- 在access阶段内部的每一个周期也必须保持不变。</td></tr><tr><td>PWUSER</td><td>USER_DATA_WIDTH</td><td>主机</td><td>用户定义的写数据。<br>- 当PSELx和PWRITE拉高时，PWUSER必须有效。<br>- 在一笔事务的setup和access阶段内PWUSER值必须保持不变。<br>- 在access阶段内部的每一个周期PWUSER也必须保持不变。</td></tr><tr><td>PRUSER</td><td>USER_DATA_WIDTH</td><td>从机</td><td>用户定义的读数据。<br>- 当PSELx、PENABLE、PREADY拉高，PWRITE拉低时，PRUSER必须有效。</td></tr><tr><td>PBUSER</td><td>USER_RESP_WIDTH</td><td>从机</td><td>用户定义的响应。<br>- 当PSEL、PENABLE、PREADY拉高时，PBUSER必须有效。</td></tr></tbody></table><h3 id=383-user信号的建议>3.8.3 user信号的建议</h3><p>在使用user信号时，不需要将所有的user信号都实现。</p><p>对于请求、数据、响应来说，信号宽度可能不一致。</p><p>【建议】user信号实现在桥中或者互联模块中，不是必须在从机模块中实现。</p><p>【建议】USER_dATA_WIDTH是byte的整数倍，这有助于数据宽度和协议的转换。</p><h1 id=第四章-操作状态>第四章 操作状态</h1><h2 id=41-操作状态机>4.1 操作状态机</h2><pre tabindex=0><code class=language-plantuml data-lang=plantuml>@startuml
title APB接口的状态机跳转
state IDLE:PSELx = 0
state SETUP:PSELx = 1\nPENABLE = 0
state ACCESS:PSELx = 1\nPENABLE = 1

IDLE --&gt; IDLE:No Transfer
IDLE --&gt; SETUP: Transfer

SETUP --&gt; ACCESS

ACCESS --&gt; ACCESS:PREADY = 0
ACCESS --&gt; SETUP:PREADY = 1\n new transfer
ACCESS --&gt; IDLE:PREADY = 1\n no transfer
@enduml
</code></pre><details><summary>状态机StartUML源码[折叠代码块]</summary><pre><code> 
@startuml
state IDLE:PSELx = 0
state SETUP:PSELx = 1\n PENABLE = 0
state ACCESS:PSELx = 1\n PENABLE = 1
<p>IDLE &ndash;&gt; IDLE:No Transfer
IDLE &ndash;&gt; SETUP: Transfer</p>
<p>SETUP &ndash;&gt; ACCESS</p>
<p>ACCESS &ndash;&gt; ACCESS:PREADY = 0
ACCESS &ndash;&gt; SETUP:PREADY = 1\n new transfer
ACCESS &ndash;&gt; IDLE:PREADY = 1\n no transfer
@enduml
</code></pre></p></details><ul><li>状态机通过以下状态进行操作</li></ul><table><tr><th>状态</th><th>描述</th></tr><tr><td>IDLE</td><td>apb接口的默认状态</td></tr><tr><td>SETUP</td><td>当需要进行事务传输时，PSELx拉高，apb接口进入该状态。<br>只在该状态保持一个周期，下个周期必定进入access状态。</td></tr><tr><td>ACCESS</td><td>PENABLE拉高，接口进入该状态。<br>在setup到access状态的转变期间以及access状态之内的周期之间，
这些信号(PADDR、PPROT、PWRITE、PWDATA[只在写事务]、PSTRB、PAUSER、PWUSER)必须保持不变。<br>离开access状态依赖从机给出的PREADY信号:<br><table><tr><td>PREADY = LOW</td><td>继续保持在access状态</td></tr><tr><td>PREADY = HIGH且无下一笔事务传输</td><td>apb接口跳转到IDLE状态</td></tr><tr><td>PREADY = HIGH且存在下一笔传输</td><td>apb接口跳转到access状态</td></tr></table></tr></table><h1 id=第五章-接口保护校验>第五章 接口保护校验</h1><p>介绍一种奇偶校验方案，用于检测组件接口上的单个bit错误。</p><h2 id=51-保护校验>5.1 保护校验</h2><p>对于关键安全应用，有必要在SOC内检测并纠正单个bit的瞬态和功能错误。</p><p>系统组件中的错误会在连接的组件上传播并导致其他错误。端到端操作需要错误检测和校正(EDC)，涵盖了从源模块到目的组件的所有逻辑和电线。</p><p>实施端到端保护的一种方法是在组价中采用自定义的EDC方案，并在组件之间实现简单的错误检测方案。在这些组件之间单个bit的错误将不会传播成多个bit错误。</p><p>本节将介绍一种奇偶校验方案，用于检测组件之间接口上的单bit错误。如果多bit错误发生在不同的信号组中，则可以被检测到。</p><pre tabindex=0><code class=language-plantuml data-lang=plantuml>@startuml
title parity在端到端组件的应用
package &#34;Source&#34;{
[Source Logic]
[Parity Generation]
}

package &#34;Interconnect&#34;{
[Interconnect Logic]
[Parity check and EDC generation] --&gt; [EDC code]

[EDC code] --&gt; [EDC check and Parity generation]

}

package &#34;Destination&#34;{
[Dest Logic]
[Parity Check]
}

[Source Logic] --&gt; [Interconnect Logic]:AMBA
[Interconnect Logic] --&gt; [Dest Logic]:AMBA

[Parity Generation] --&gt; [Parity check and EDC generation]:Parity

[EDC check and Parity generation] --&gt; [Parity Check]:Parity
@enduml
</code></pre><details><summary>组件图StartUML源码[折叠代码块]</summary><pre><code> 
title parity在端到端组件的应用
package "Source"{
[Source Logic]
[Parity Generation]
}
<p>package &ldquo;Interconnect&rdquo;{
[Interconnect Logic]
[Parity check and EDC generation] &ndash;&gt; [EDC code]</p>
<p>[EDC code] &ndash;&gt; [EDC check and Parity generation]</p>
<p>}</p>
<p>package &ldquo;Destination&rdquo;{
[Dest Logic]
[Parity Check]
}</p>
<p>[Source Logic] &ndash;&gt; [Interconnect Logic]:AMBA
[Interconnect Logic] &ndash;&gt; [Dest Logic]:AMBA</p>
<p>[Parity Generation] &ndash;&gt; [Parity check and EDC generation]:Parity</p>
<p>[EDC check and Parity generation] &ndash;&gt; [Parity Check]:Parity
@enduml
</code></pre></p></details><h2 id=52-接口保护的配置>5.2 接口保护的配置</h2><p>使用Check_Type对EDC进行配置。</p><table><thead><tr><th>值</th><th>描述</th></tr></thead><tbody><tr><td>False</td><td>不对接口进行检查(默认配置)</td></tr><tr><td>Odd_parity_Byte_All</td><td>进行奇校验，并且以8bit为一个校验单位</td></tr></tbody></table><blockquote><p>信号检查只能在APB5中使用。</p></blockquote><h2 id=53-奇偶校验>5.3 奇偶校验</h2><p>当使用奇校验时即校验位为1，意味着在接口信号和检查信号中bit位为1的数量总是奇数个。check信号和接口信号是相关联的。</p><p>每一组奇偶校验的bit数不超过8个，这限制了在生成校验位的时候不超过三层逻辑。</p><p>可用一个bit的校验位来定义关键控制信号的奇偶校验信息。该奇偶校验位是原始关键控制信号的一种映射。<span style=background-color:#ff0>
不明白[Parity signals that cover critical control signals are defined with a single parity bit. The single odd parity bit
is the inversion of the original critical control signal. Critical control signals are likely to have a smaller
timing allowance available.]</span></p><p>对于比1bit宽的检查信号</p><ul><li>check bit[n]对应[8n+7:8n] payload信号</li><li>如果check信号bit位数不是8的整数倍，check信号的最高位应当包含payload信号的最高部分。</li></ul><p>每个check信号需要在check使能为真时被正确驱动。</p><p>无论payload信号中每一个bit是否被使用，校验信号都应该是相关payload信号的驱动结果。</p><p>如果生成check信号的源payload信号并没有出现在接口中，那么缺失的信号被假定为低电平。</p><p>如果接口上没有符合check信号的任何信号，那么check信号将直接被忽略。</p><h2 id=54-错误检查行为>5.4 错误检查行为</h2><p>该规范对于错误检查之后的行为没有任何规定。依据系统和受影响的信号不同，可能造成性能问题、数据错误、安全漏洞或者导致死锁。</p><p>当检查到错误，从机可以进行的操作：</p><ul><li>终止或者选择继续传输事务；</li><li>纠正错误或者传播错误；</li><li>更新内存或者不采取任何行为；</li><li>通过其他信号反馈错误，例如；中断信号</li></ul><h2 id=55-校验check信号>5.5 校验check信号</h2><p>check信号和PCLK是同步的，并且在Check Enable为真时正确地在每个周期驱动。</p><table><thead><tr><th>check信号</th><th>相关联的信号</th><th>位宽</th><th>颗粒度</th><th>check使能</th></tr></thead><tbody><tr><td>PADDRCHK</td><td>PADDR</td><td>ceil(ADDR_WIDTH/8)</td><td>1-8</td><td>PSEL</td></tr><tr><td>PCTRLCHK</td><td>PPROT、PWRITE、PNSE</td><td>1</td><td>1-5</td><td>PSEL</td></tr><tr><td>PSELxCHK</td><td>PSELx</td><td>1</td><td>PRESETn</td><td></td></tr><tr><td>PENABLECHK</td><td>PENABLE</td><td>1</td><td>1</td><td>PSEL</td></tr><tr><td>PWDATACHK</td><td>PWDATA</td><td>DATA_WIDTH/8</td><td>8</td><td>PSEL&amp;PWRITE</td></tr><tr><td>PSTRBCHK</td><td>PSTRB</td><td>1</td><td>1-4</td><td>PSEL&amp;PWRITE</td></tr><tr><td>PREADYCHK</td><td>PREADY</td><td>1</td><td>1</td><td>PSEL&amp;PENABLE</td></tr><tr><td>PRDATACHK</td><td>PRDATA</td><td>DATA_WIDTH/8</td><td>8</td><td>PSEL&amp;PENABLE&amp;PREADY&!PWRITE</td></tr><tr><td>PSLVERRCHK</td><td>PSLVERR</td><td>1</td><td>1</td><td>PSEL&amp;PENABLE&amp;PREADY</td></tr><tr><td>PWAKEUPCHK</td><td>PWAKEUP</td><td>1</td><td>1</td><td>PRESETn</td></tr><tr><td>PAUSERCHK</td><td>PAUSER</td><td>ceil(USER_REQ_WIDTH/8)</td><td>1-8</td><td>PSEL</td></tr><tr><td>PWUSERCHK</td><td>PWUSER</td><td>ceil(USER_DATA_WIDTH/8</td><td>1-8</td><td>PSEL&amp;PWRITE</td></tr><tr><td>PRUSERCHK</td><td>PRUSER</td><td>ceil(USER_DATA_WIDTH/8)</td><td>1-8</td><td>PSEL&amp;PENABLE&amp;PREADY&!PWRITE</td></tr><tr><td>PBUSERCHK</td><td>PBUSER</td><td>ceil(USER_RESP_WIDTH/8)</td><td>1-8</td><td>PSEL&amp;PENABLE&amp;PREADY</td></tr></tbody></table><blockquote><p>Note：ceil()对括号内的数值向下取整。
Note：对PSEL分开检查，是由于只有一个PSEL会路由到每个从机。</p></blockquote><h1 id=附录a-信号的有效性>附录A 信号的有效性</h1><p>下面信号必须总是有效：</p><ul><li>PSEL</li><li>PWAKEUP</li></ul><p>当PSEL为高时，下面信号必须有效：</p><ul><li>PADDR</li><li>PPROT</li><li>PNSE</li><li>PENABLE</li><li>PWRITE</li><li>PAUSER</li><li>STRB</li><li>PWDATA(只在写事务)</li><li>PWUSER(只在写事务)</li></ul><p>当PSEL和PENABLE为高时，下面信号必须有效：</p><ul><li>PREADY</li></ul><p>当PSEL、PENABLE、PREADY为高时，下面信号必须有效：</p><ul><li><p>PRDATA(只在读事务)</p></li><li><p>PSLVERR</p></li><li><p>PRUSER(只在读事务)</p></li><li><p>PBUSER</p></li><li><p>【建议】不需要右下的信号驱动为0。</p></li></ul><h1 id=附录b-信号列表>附录B 信号列表</h1><h2 id=b1-apb-信号>B.1 APB 信号</h2><blockquote><p>Y ：Mandatory(强制性的)<br>N ：不允许出现<br>O ：可选为输出或输入<br>OO ：可选为输出，强制为输入<br> C：带有条件性，如果该属性为True，则必须存在<br>OC ：条件可选，如果该属性为True，则是可选的</p></blockquote><p><strong>Normal Signal<strong></p><table><thead><tr><th>signal</th><th>width</th><th>default</th><th>property</th><th>APB5</th><th>apb4</th><th>APB3</th><th>APB2</th></tr></thead><tbody><tr><td>PCLK</td><td>1</td><td>-</td><td>-</td><td>Y</td><td>Y</td><td>Y</td><td>Y</td></tr><tr><td>PRESETn</td><td>1</td><td>-</td><td>-</td><td>Y</td><td>Y</td><td>Y</td><td>Y</td></tr><tr><td>PADDR</td><td>ADDR_WIDTH</td><td>-</td><td>-</td><td>Y</td><td>Y</td><td>Y</td><td>Y</td></tr><tr><td>PPROT</td><td>3</td><td>0b000</td><td>−</td><td>O</td><td>O</td><td>N</td><td>N</td></tr><tr><td>PNSE</td><td>1</td><td>0b0</td><td>RME_Support</td><td>C</td><td>N</td><td>N</td><td>N</td></tr><tr><td>PSELx</td><td>1</td><td>−</td><td>−</td><td>Y</td><td>Y</td><td>Y</td><td>Y</td></tr><tr><td>PENABLE</td><td>1</td><td>−</td><td>−</td><td>Y</td><td>Y</td><td>Y</td><td>Y</td></tr><tr><td>PWRITE</td><td>1</td><td>−</td><td>−</td><td>Y</td><td>Y</td><td>Y</td><td>Y</td></tr><tr><td>PWDATA</td><td>DATA_WIDTH</td><td>−</td><td>−</td><td>Y</td><td>Y</td><td>Y</td><td>Y</td></tr><tr><td>PSTRB</td><td>DATA_WIDTH/8</td><td>−</td><td>−</td><td>O</td><td>O</td><td>N</td><td>N</td></tr><tr><td>PREADY</td><td>1</td><td>0b1</td><td>−</td><td>OO</td><td>OO</td><td>OO</td><td>N</td></tr><tr><td>PRDATA</td><td>DATA_WIDTH</td><td>0b0</td><td>−</td><td>Y</td><td>Y</td><td>Y</td><td>Y</td></tr><tr><td>PSLVERR</td><td>1</td><td>0b0</td><td>−</td><td>OO</td><td>OO</td><td>OO</td><td>N</td></tr><tr><td>PWAKEUP</td><td>1</td><td>−</td><td>Wakeup_signal</td><td>C</td><td>N</td><td>N</td><td>N</td></tr><tr><td>PAUSER</td><td>USER_REQ_WIDTH</td><td>−</td><td>USER_REQ_WIDTH</td><td>OC</td><td>N</td><td>N</td><td>N</td></tr><tr><td>PWUSER</td><td>USER_DATA_WIDTH</td><td>−</td><td>USER_DATA_WIDTH</td><td>OC</td><td>N</td><td>N</td><td>N</td></tr><tr><td>PRUSER</td><td>USER_DATA_WIDTH</td><td>−</td><td>USER_DATA_WIDTH</td><td>OC</td><td>N</td><td>N</td><td>N</td></tr><tr><td>PBUSER</td><td>USER_RESP_WIDTH</td><td>−</td><td>USER_RESP_WIDTH</td><td>OC</td><td>N</td><td>N</td><td>N</td></tr></tbody></table><p><strong>Check Signal<strong></p><table><thead><tr><th>signal</th><th>width</th><th>property</th><th>APB5</th><th>apb4</th><th>APB3</th><th>APB2</th></tr></thead><tbody><tr><td>———————</td><td>—————————————</td><td>——————————————</td><td>————</td><td>————</td><td>————</td><td>————</td></tr><tr><td>PADDRCHK</td><td>ADDR_WIDTH/8</td><td>Check_Type</td><td>C</td><td>N</td><td>N</td><td>N</td></tr><tr><td>PCTRLCHK</td><td>1</td><td>Check_Type</td><td>C</td><td>N</td><td>N</td><td>N</td></tr><tr><td>PSELxCHK</td><td>1</td><td>Check_Type</td><td>C</td><td>N</td><td>N</td><td>N</td></tr><tr><td>PENABLECHK</td><td>1</td><td>Check_Type</td><td>C</td><td>N</td><td>N</td><td>N</td></tr><tr><td>PWDATACHK</td><td>DATA_WIDTH/8</td><td>Check_Type</td><td>C</td><td>N</td><td>N</td><td>N</td></tr><tr><td>PSTRBCHK</td><td>1</td><td>Check_Type</td><td>C</td><td>N</td><td>N</td><td>N</td></tr><tr><td>PREADYCHK</td><td>1</td><td>Check_Type</td><td>C</td><td>N</td><td>N</td><td>N</td></tr><tr><td>PRDATACHK</td><td>DATA_WIDTH/8</td><td>Check_Type</td><td>C</td><td>N</td><td>N</td><td>N</td></tr><tr><td>PSLVERRCHK</td><td>1</td><td>Check_Type</td><td>OC</td><td>N</td><td>N</td><td>N</td></tr><tr><td>PWAKEUPCHK</td><td>1</td><td>Check_Type & Wakeup_Signal</td><td>C</td><td>N</td><td>N</td><td>N</td></tr><tr><td>PAUSERCHK</td><td>ceil(USER_REQ_WIDTH/8)</td><td>Check_Type & USER_REQ_WIDTH</td><td>OC</td><td>N</td><td>N</td><td>N</td></tr><tr><td>PWUSERCHK</td><td>ceil(USER_DATA_WIDTH/8)</td><td>Check_Type & USER_DATA_WIDTH</td><td>OC</td><td>N</td><td>N</td><td>N</td></tr><tr><td>PRUSERCHK</td><td>ceil(USER_DATA_WIDTH/8)</td><td>Check_Type & USER_DATA_WIDTH</td><td>OC</td><td>N</td><td>N</td><td>N</td></tr><tr><td>PBUSERCHK</td><td>ceil(USER_RESP_WIDTH/8)</td><td>Check_Type & USER_RESP_WIDTH</td><td>OC</td><td>N</td><td>N</td><td>N</td></tr></tbody></table><p><strong>Interface Properties<strong></p><table><thead><tr><th>Property</th><th>Issue introduced</th><th>APB5</th><th>APB4</th><th>APB3</th><th>APB2</th></tr></thead><tbody><tr><td>Check_Type</td><td>D</td><td>y</td><td>&mdash;</td><td></td><td></td></tr><tr><td>USER_REQ_WIDTH</td><td>D</td><td>y</td><td>&mdash;</td><td></td><td></td></tr><tr><td>USER_DATA_WIDTH</td><td>D</td><td>y</td><td>&mdash;</td><td></td><td></td></tr><tr><td>USER_RESP_WIDTH</td><td>D</td><td>y</td><td>&mdash;</td><td></td><td></td></tr><tr><td>Wakeup_Signal</td><td>D</td><td>y</td><td>&mdash;</td><td></td><td></td></tr></tbody></table><blockquote><p>Note：对于非Y的APB版本版本，相应的属性必须是False或者在接口信号中不要定义。</p></blockquote><h1 id=附录c-版本历史>附录C 版本历史</h1><table><thead><tr><th>版本</th><th>内容</th></tr></thead><tbody><tr><td>APB2</td><td>PCLK<br>PRESETn<br>PSEL<br>PENABLE<br>PWRITE<br>PADDR<br>PWDATA<br>PRDATA</td></tr><tr><td>APB3</td><td>+PREADY<br>+PSLVERR</td></tr><tr><td>APB4</td><td>+PSTRB<br>+PPROT</td></tr><tr><td>APB5</td><td>+PAUSER<br>+PWUSER<br>+PRUSER<br>+PBUSER<br>+PWAKEUP<br>+【接口校验】<br>+PNSE</td></tr></tbody></table><hr><ul class=pager><li class=previous><a href=/icer/post/%E5%AD%97%E8%8A%82%E5%BA%8F%E6%B5%85%E8%B0%88/ data-toggle=tooltip data-placement=top title=字节序浅谈>&larr;
Previous Post</a></li><li class=next><a href=/icer/post/multi-layer-ahb-%E5%8D%8F%E8%AE%AE%E7%BF%BB%E8%AF%91/ data-toggle=tooltip data-placement=top title=Multi-layer-AHB-协议翻译>Next
Post &rarr;</a></li></ul><script src=https://giscus.app/client.js data-repo=ICJJ/icer data-repo-id=R_kgDOMWEQRg data-category=General data-category-id=DIC_kwDOMWEQRs4CgyrH data-mapping=pathname data-reactions-enabled=1 data-emit-metadata=0 data-theme=light data-lang=en crossorigin=anonymous async></script></div><div class="col-lg-2 col-lg-offset-0
visible-lg-block
sidebar-container
catalog-container"><div class=side-catalog><hr class="hidden-sm hidden-xs"><h5><a class=catalog-toggle href=#>CATALOG</a></h5><ul class=catalog-body></ul></div></div><div class="col-lg-8 col-lg-offset-2
col-md-10 col-md-offset-1
sidebar-container"><section><hr class="hidden-sm hidden-xs"><h5><a href=/tags/>FEATURED TAGS</a></h5><div class=tags><a href=/icer/tags/ahb title=ahb>ahb
</a><a href=/icer/tags/amba title=amba>amba
</a><a href=/icer/tags/amba5 title=amba5>amba5
</a><a href=/icer/tags/apb title=apb>apb
</a><a href=/icer/tags/bus title=bus>bus
</a><a href=/icer/tags/git title=git>git
</a><a href=/icer/tags/html title=html>html
</a><a href=/icer/tags/multi-layer-ahb title=multi-layer-ahb>multi-layer-ahb
</a><a href=/icer/tags/%E5%8D%8F%E8%AE%AE%E7%BF%BB%E8%AF%91 title=协议翻译>协议翻译
</a><a href=/icer/tags/%E5%A4%A7%E5%B0%8F%E7%AB%AF title=大小端>大小端
</a><a href=/icer/tags/%E5%AD%97%E8%8A%82%E5%BA%8F title=字节序>字节序</a></div></section><section><hr><h5>FRIENDS</h5><ul class=list-inline><li><a target=_blank href=https://zhaozhihan.com>Linda的博客</a></li></ul></section></div></div></div></article><footer><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><ul class="list-inline text-center"><li><a href=mailto:chengjj9527@gmail.com><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fas fa-envelope fa-stack-1x fa-inverse"></i></span></a></li><li><a target=_blank href=https://github.com/icjj><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fab fa-github fa-stack-1x fa-inverse"></i></span></a></li><li><a target=_blank href=https://github.com/ICJJ><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fab fa-gitlab fa-stack-1x fa-inverse"></i></span></a></li><li><a target=_blank href=https://stackoverflow.com/users/26381389><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fab fa-stack-overflow fa-stack-1x fa-inverse"></i></span></a></li><li><a href rel=alternate type=application/rss+xml title="ICJJ Blog"><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fas fa-rss fa-stack-1x fa-inverse"></i></span></a></li></ul><p class="copyright text-muted">Copyright &copy; ICJJ Blog 2024<br><a href=https://themes.gohugo.io/hugo-theme-cleanwhite>CleanWhite Hugo Theme</a> by <a href=https://zhaohuabing.com>Huabing</a> |
<iframe style=margin-left:2px;margin-bottom:-5px frameborder=0 scrolling=0 width=100px height=20px src="https://ghbtns.com/github-btn.html?user=zhaohuabing&repo=hugo-theme-cleanwhite&type=star&count=true"></iframe></p></div></div></div></footer><script>function loadAsync(e,t){var s=document,o="script",n=s.createElement(o),i=s.getElementsByTagName(o)[0];n.src=e,t&&n.addEventListener("load",function(e){t(null,e)},!1),i.parentNode.insertBefore(n,i)}</script><script>$("#tag_cloud").length!==0&&loadAsync("/js/jquery.tagcloud.js",function(){$.fn.tagcloud.defaults={color:{start:"#bbbbee",end:"#0085a1"}},$("#tag_cloud a").tagcloud()})</script><script>loadAsync("https://cdn.jsdelivr.net/npm/fastclick@1.0.6/lib/fastclick.min.js",function(){var e=document.querySelector("nav");e&&FastClick.attach(e)})</script><script type=text/javascript>function generateCatalog(e){_containerSelector="div.post-container";var t,n,s,o,i,a=$(_containerSelector),r=a.find("h1,h2,h3,h4,h5,h6");return $(e).html(""),r.each(function(){t=$(this).prop("tagName").toLowerCase(),o="#"+$(this).prop("id"),n=$(this).text(),i=$('<a href="'+o+'" rel="nofollow">'+n+"</a>"),s=$('<li class="'+t+'_nav"></li>').append(i),$(e).append(s)}),!0}generateCatalog(".catalog-body"),$(".catalog-toggle").click(function(e){e.preventDefault(),$(".side-catalog").toggleClass("fold")}),loadAsync("/icer/js/jquery.nav.js",function(){$(".catalog-body").onePageNav({currentClass:"active",changeHash:!1,easing:"swing",filter:"",scrollSpeed:700,scrollOffset:0,scrollThreshold:.2,begin:null,end:null,scrollChange:null,padding:80})})</script><script src=https://cdn.jsdelivr.net/gh/jmnote/plantuml-encoder@1.2.4/dist/plantuml-encoder.min.js integrity="sha256-Qsk2KRBCN5qVZX7B+8+2IvQl1Aqc723qV1tBCQaVoqo=" crossorigin=anonymous></script><script>(function(){let e="language-plantuml";Array.prototype.forEach.call(document.querySelectorAll("[class^="+e+"]"),function(e){let t=document.createElement("IMG");t.loading="lazy",t.src="http://www.plantuml.com/plantuml/svg/~1"+plantumlEncoder.encode(e.innerText),e.parentNode.parentNode.insertBefore(t,e.parentNode),e.parentNode.style.display="none"})})()</script></body></html>